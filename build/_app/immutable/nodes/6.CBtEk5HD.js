import{f as G,a as p,c as P}from"../chunks/DGGwx3xc.js";import{p as Fe,o as Ce,q as $,v as e,g as w,w as N,s as Z,t as ne,e as Ee,r as M,f as T,x as R,$ as Re}from"../chunks/D6p2bPIS.js";import{s as we,e as Ae}from"../chunks/CdfSubKN.js";import{p as Ge,i as h,b as S,a as Ue,s as qe}from"../chunks/DG-iDFzR.js";import{g as He}from"../chunks/BvgHV7Rw.js";import{d as A,s as Ie,b as We,i as Ze,c as Me,e as xe,f as De,h as he,g as Be,N as Ke,a as Qe,p as Xe}from"../chunks/Ccx2UmLp.js";import{o as Ye,c as et}from"../chunks/DEdxNy7H.js";import{a as Je,o as $e}from"../chunks/YEikM6LL.js";import{z as tt,g as st,a as at,M as Se,T as ot,L as Le}from"../chunks/CiAuv0o1.js";import{s as Y}from"../chunks/BK0IujWt.js";var rt=G('<div id="story-context-container" class="svelte-7d3ou1"><div id="era-short-label" class="svelte-7d3ou1"> </div> <div id="era-long-label" class="svelte-7d3ou1"> </div></div>'),it=G('<h2 class="svelte-7d3ou1"><!></h2>'),nt=G('<h2 class="svelte-7d3ou1"><!></h2>'),lt=G("<p><!></p>"),vt=G('<div id="story-narrative-container" class="svelte-7d3ou1"><div id="story-narrative" class="svelte-7d3ou1"><h1 class="svelte-7d3ou1"> </h1> <!></div></div>'),ut=G('<div id="map"><!> <!> <svg id="map-svg"><g><!></g></svg></div>');function ct(le,ee){Fe(ee,!0);let a=Ge(ee,"story",19,()=>({}));function ve(t){console.log("Maps:onChapterMouseOver(event:"+JSON.stringify(t.detail)+")"),n.forEach(l=>{l.onChapterMouseOver&&l.onChapterMouseOver(t)})}function ue(t){console.log("Maps:onChapterMouseLeave(event:"+JSON.stringify(t.detail)+")"),n.forEach(l=>{l.onChapterMouseLeave&&l.onChapterMouseLeave(t)})}function B(t){console.log(`Maps:onNavigate(event:${JSON.stringify(t.detail)})`),N(o,t.detail.viewID,!0),N(_,t.detail.eraID,!0),N(i,null),a().views[e(o)].extent&&q(a().views[e(o)].extent)}let n=Ce([]),C=$(void 0),L=$(void 0),y,F,te,o=$(Ce(a().intialView)),_=$(null),i=$(null),m=$(void 0),se=$(!0);const ae=2500;Ye(()=>{console.log("Maps:onMount()"),y=parseInt(A(e(C)).style("width"),10),F=parseInt(A(e(C)).style("height"),10),console.log(`Map width: ${y}; height: ${F}`),N(m,at().rotate([74,0]).fitSize([y,F],r(a().views[a().intialView].extent)),!0),N(se,!1)}),te=tt().on("zoom",ce);const U=et();function q(t){console.log(`Maps:moveMap(extent:${JSON.stringify(t)}`),y=parseInt(A("#map-svg").style("width"),10),F=parseInt(A("#map-svg").style("height"),10),console.log(`Map width: ${y}; height: ${F}`);const l=r(t);var I=st().projection(e(m));const x=I.bounds(l),[[s,d],[E,u]]=x;A(e(L)).transition().duration(ae).call(te.transform,Ze.translate(y/2,F/2).scale(.9/Math.max((E-s)/y,(u-d)/F)).translate(-(s+E)/2,-(d+u)/2))}function ce(t){const{transform:l}=t;A(e(L)).attr("transform",l),A(e(L)).selectAll("text").attr("font-size",10/l.k)}function r(t){return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{coordinates:[[[t.nwLng,t.nwLat],[t.seLng,t.nwLat],[t.seLng,t.seLat],[t.nwLng,t.seLat],[t.nwLng,t.nwLat]]],type:"Polygon"}}]}}function oe(t){console.log("Maps:onFeatureMouseOver(event.detail:"+JSON.stringify(t.detail)+")"),U("featureMouseOver",t.detail)}function ye(t){console.log("Maps:onFeatureMouseOut(event.detail:"+JSON.stringify(t.detail)+")"),U("featureMouseOut",t.detail)}function _e(t){console.log("Maps:onFeatureClick(event.detail:"+JSON.stringify(t.detail)+")"),U("featureClick",t.detail)}function me(t){console.log(`Maps:onStop(stopID:${t})`),N(i,t,!0),t?a().views[e(o)].stops&&a().views[e(o)].stops[e(i)]&&q(a().views[e(o)].stops[e(i)].extent):q(a().views[e(o)].extent)}var K=ut(),Oe=w(K);{var ke=t=>{var l=rt(),I=w(l),x=w(I,!0);M(I);var s=Z(I,2),d=w(s);M(s),M(l),ne(()=>{we(x,a().eras[e(_)].shortLabel),we(d,`${a().eras[e(_)].longLabel??""} (New Map!!!)`)}),p(t,l)};h(Oe,t=>{e(_)&&t(ke)})}var be=Z(Oe,2);{var je=t=>{var l=vt(),I=w(l),x=w(I),s=w(x,!0);M(x),Je(x,(E,u)=>{var V;return(V=$e)==null?void 0:V(E,u)},()=>me);var d=Z(x,2);xe(d,17,()=>a().views[e(o)].story,De,(E,u)=>{var V=P(),Q=T(V);{var ie=j=>{var H=P(),D=T(H);{var J=f=>{var v=it(),c=w(v);he(c,()=>e(u).text),M(v),Je(v,(O,b)=>{var g;return(g=$e)==null?void 0:g(O,b)},()=>me),ne(()=>Be(v,"data-id",e(u).stop)),p(f,v)},k=f=>{var v=nt(),c=w(v);he(c,()=>e(u).text),M(v),p(f,v)};h(D,f=>{e(u).stop?f(J):f(k,!1)})}p(j,H)},ge=(j,H)=>{{var D=J=>{var k=lt(),f=w(k);he(f,()=>e(u).text),M(k),p(J,k)};h(j,J=>{e(u).type=="p"&&J(D)},H)}};h(Q,j=>{e(u).type=="h"?j(ie):j(ge,!1)})}p(E,V)}),M(I),M(l),ne(()=>we(s,a().views[e(o)].name)),p(t,l)};h(be,t=>{a().views[e(o)].story&&t(je)})}var re=Z(be,2);let Ne;var pe=w(re),Te=w(pe);{var Ve=t=>{var l=P(),I=T(l);xe(I,17,()=>Object.values(a().maps),De,(x,s,d)=>{var E=P(),u=T(E);{var V=Q=>{var ie=P(),ge=T(ie);{var j=D=>{var J=P(),k=T(J);{var f=c=>{const O=R(()=>e(s).geometryType?e(s).geometryType:"polygons"),b=R(()=>e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id));S(Se(c,{get activeViewID(){return e(o)},get activeEraID(){return e(_)},get activeStopID(){return e(i)},get url(){return e(s).url},get topoJson(){return e(s).topoJson},get topoJsonObjectsName(){return e(s).topoJsonObjectsName},get geometryType(){return e(O)},get id(){return e(s).id},get projection(){return e(m)},get visible(){return e(b)},interactive:!0,$$events:{featureMouseOver:oe,featureMouseOut:ye,featureClick:_e}}),(g,X)=>n[X]=g,g=>n==null?void 0:n[g],()=>[d])},v=c=>{const O=R(()=>e(s).geometryType?e(s).geometryType:"polygons"),b=R(()=>e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id));S(Se(c,{get activeViewID(){return e(o)},get activeEraID(){return e(_)},get activeStopID(){return e(i)},get url(){return e(s).url},get topoJson(){return e(s).topoJson},get topoJsonObjectsName(){return e(s).topoJsonObjectsName},get geometryType(){return e(O)},get id(){return e(s).id},get projection(){return e(m)},get visible(){return e(b)}}),(g,X)=>n[X]=g,g=>n==null?void 0:n[g],()=>[d])};h(k,c=>{e(s).interactive?c(f):c(v,!1)})}p(D,J)},H=(D,J)=>{{var k=v=>{const c=R(()=>e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id));S(ot(v,{get urlPath(){return e(s).urlPath},get urlExtension(){return e(s).urlExtension},get projection(){return e(m)},get visible(){return e(c)}}),(O,b)=>n[b]=O,O=>n==null?void 0:n[O],()=>[d])},f=(v,c)=>{{var O=b=>{var g=P(),X=T(g);{var ze=W=>{const de=R(()=>e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id));S(Le(W,{get activeViewID(){return e(o)},get activeEraID(){return e(_)},get activeStopID(){return e(i)},get path(){return e(s).path},get id(){return e(s).id},get projection(){return e(m)},get visible(){return e(de)},get labelField(){return e(s).labelField},get filterOnContext(){return e(s).filterOnContext},get interactive(){return e(s).interactive},$$events:{featureMouseOver:oe,featureMouseOut:ye,featureClick:_e}}),(z,fe)=>n[fe]=z,z=>n==null?void 0:n[z],()=>[d])},Pe=W=>{const de=R(()=>e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id));S(Le(W,{get activeViewID(){return e(o)},get activeEraID(){return e(_)},get activeStopID(){return e(i)},get path(){return e(s).path},get id(){return e(s).id},get projection(){return e(m)},get visible(){return e(de)},get labelField(){return e(s).labelField},get filterOnContext(){return e(s).filterOnContext},get interactive(){return e(s).interactive}}),(z,fe)=>n[fe]=z,z=>n==null?void 0:n[z],()=>[d])};h(X,W=>{e(s).interactive?W(ze):W(Pe,!1)})}p(b,g)};h(v,b=>{e(s).type=="label"&&b(O)},c)}};h(D,v=>{e(s).type=="tile"?v(k):v(f,!1)},J)}};h(ge,D=>{e(s).type=="shapefile"?D(j):D(H,!1)})}p(Q,ie)};h(u,Q=>{(e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id))&&Q(V)})}p(x,E)}),p(t,l)};h(Te,t=>{e(se)||t(Ve)})}return M(pe),S(pe,t=>N(L,t),()=>e(L)),M(re),S(re,t=>N(C,t),()=>e(C)),M(K),ne(t=>{Ie(K,1,`${`view-${e(o)}`} ${`era-${e(_)}`} ${`stop-${e(i)}`}`,"svelte-7d3ou1"),We(K,`--color-era-urban-industrial: ${Me.colorEraUrbanIndustrial}; --color-era-pre-1600s: ${Me.colorEraPre1600s}; --color-era-early-european-settlement: ${Me.colorEraEarlyEuropeanSettlement}`),Ne=Ie(re,0,"svelte-7d3ou1",null,Ne,t)},[()=>({story:a().views[e(o)].story!=null})]),p(le,K),Ee({onChapterMouseOver:ve,onChapterMouseLeave:ue,onNavigate:B})}var pt=G("<!> <!> <!>",1);function bt(le,ee){Fe(ee,!0);const[a,ve]=Ue(),ue=()=>qe(Xe,"$page",a);let B=$(void 0),n=$(void 0),C=$(void 0),L="intro";Y.views[L];let y=null;function F(r){console.log("routes/map:onFeatureMouseOver(event.detail:"+JSON.stringify(r.detail)+")"),e(n).onMapFeatureMouseOver(r)}function te(r){console.log("routes/map:onMapFeatureMouseOut(event.detail:"+JSON.stringify(r.detail)+")"),e(n).onMapFeatureMouseOut(r)}function o(r){console.log("routes/map:onChapterMouseOver(event.detail:"+JSON.stringify(r.detail)+")"),e(C).onChapterMouseOver(r)}function _(r){console.log("routes/map:onChapterMouseLeave(event.detail:"+JSON.stringify(r.detail)+")"),e(C).onChapterMouseLeave(r)}function i(r){console.log("routes/map:onFeatureClick(event.detail:"+JSON.stringify(r.detail)+")"),e(n).onMapFeatureClick(r)}function m(r,oe=!0){console.log(`routes/map:onNavigate(event.detail:${JSON.stringify(r.detail)})`),L=r.detail.viewID,Y.views[L],y=r.detail.eraID,y&&Y.eras[y],e(B).navigate(r),e(C).onNavigate(r),e(n).onNavigate(r),oe&&He(`#/view/${r.detail.viewID}`,{state:r.detail})}function se(r){r.state&&(console.log(`routes/:popstate:event.state:${JSON.stringify(r.state)}`),console.log(`routes/:popstate:page.state:${JSON.stringify(ue().state)}`),r.state["sveltekit:states"].viewID&&m({detail:{...r.state["sveltekit:states"]}},!1))}var ae=pt();Ae("popstate",Re,se);var U=T(ae);S(Ke(U,{$$events:{navigate:m}}),r=>N(B,r,!0),()=>e(B));var q=Z(U,2);S(ct(q,{story:Y,$$events:{featureMouseOver:F,featureMouseOut:te,featureClick:i}}),r=>N(C,r,!0),()=>e(C));var ce=Z(q,2);S(Qe(ce,{get eras(){return Y.eras},$$events:{chapterMouseOver:o,chapterMouseLeave:_,navigate:m}}),r=>N(n,r,!0),()=>e(n)),p(le,ae),Ee(),ve()}export{bt as component};
