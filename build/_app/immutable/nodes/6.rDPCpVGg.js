import{f as G,a as p,c as P}from"../chunks/DMFbEwmD.js";import{p as Fe,j as Ce,k as x,l as e,g as M,m as N,s as q,t as ne,e as ke,r as h,f as T,u as R,$ as Re}from"../chunks/DOY4fili.js";import{s as Me,e as Ae}from"../chunks/D-NiPBEI.js";import{p as Ge,i as w,b as S,s as Ue,a as He}from"../chunks/BSIkstgr.js";import{g as We}from"../chunks/CAfbYLu4.js";import{e as A,s as Ie,b as Ze,i as qe,c as he,f as De,g as Je,h as we,d as Be,N as Ke,a as Qe,p as Xe}from"../chunks/DEXSg4nA.js";import{o as Ye,c as et}from"../chunks/CVwtih0k.js";import{z as tt,g as st,a as at,b as $e,o as xe,M as Se,T as ot,L as Le}from"../chunks/BvyIR9JA.js";import{s as Y}from"../chunks/dKPTXdqp.js";var rt=G('<div id="story-context-container" class="svelte-7d3ou1"><div id="era-short-label" class="svelte-7d3ou1"> </div> <div id="era-long-label" class="svelte-7d3ou1"> </div></div>'),it=G('<h2 class="svelte-7d3ou1"><!></h2>'),nt=G('<h2 class="svelte-7d3ou1"><!></h2>'),lt=G("<p><!></p>"),vt=G('<div id="story-narrative-container" class="svelte-7d3ou1"><div id="story-narrative" class="svelte-7d3ou1"><h1 class="svelte-7d3ou1"> </h1> <!></div></div>'),ut=G('<div id="map"><!> <!> <svg id="map-svg"><g><!></g></svg></div>');function ct(le,ee){Fe(ee,!0);let a=Ge(ee,"story",19,()=>({}));function ve(t){console.log("Maps:onChapterMouseOver(event:"+JSON.stringify(t.detail)+")"),n.forEach(l=>{l.onChapterMouseOver&&l.onChapterMouseOver(t)})}function ue(t){console.log("Maps:onChapterMouseLeave(event:"+JSON.stringify(t.detail)+")"),n.forEach(l=>{l.onChapterMouseLeave&&l.onChapterMouseLeave(t)})}function B(t){console.log(`Maps:onNavigate(event:${JSON.stringify(t.detail)})`),N(o,t.detail.viewID,!0),N(_,t.detail.eraID,!0),N(i,null),a().views[e(o)].extent&&H(a().views[e(o)].extent)}let n=Ce([]),C=x(void 0),L=x(void 0),y,F,te,o=x(Ce(a().intialView)),_=x(null),i=x(null),O=x(void 0),se=x(!0);const ae=2500;Ye(()=>{console.log("Maps:onMount()"),y=parseInt(A(e(C)).style("width"),10),F=parseInt(A(e(C)).style("height"),10),console.log(`Map width: ${y}; height: ${F}`),N(O,at().rotate([74,0]).fitSize([y,F],r(a().views[a().intialView].extent)),!0),N(se,!1)}),te=tt().on("zoom",ce);const U=et();function H(t){console.log(`Maps:moveMap(extent:${JSON.stringify(t)}`),y=parseInt(A("#map-svg").style("width"),10),F=parseInt(A("#map-svg").style("height"),10),console.log(`Map width: ${y}; height: ${F}`);const l=r(t);var I=st().projection(e(O));const D=I.bounds(l),[[s,d],[k,u]]=D;A(e(L)).transition().duration(ae).call(te.transform,qe.translate(y/2,F/2).scale(.9/Math.max((k-s)/y,(u-d)/F)).translate(-(s+k)/2,-(d+u)/2))}function ce(t){const{transform:l}=t;A(e(L)).attr("transform",l),A(e(L)).selectAll("text").attr("font-size",10/l.k)}function r(t){return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{coordinates:[[[t.nwLng,t.nwLat],[t.seLng,t.nwLat],[t.seLng,t.seLat],[t.nwLng,t.seLat],[t.nwLng,t.nwLat]]],type:"Polygon"}}]}}function oe(t){console.log("Maps:onFeatureMouseOver(event.detail:"+JSON.stringify(t.detail)+")"),U("featureMouseOver",t.detail)}function ye(t){console.log("Maps:onFeatureMouseOut(event.detail:"+JSON.stringify(t.detail)+")"),U("featureMouseOut",t.detail)}function _e(t){console.log("Maps:onFeatureClick(event.detail:"+JSON.stringify(t.detail)+")"),U("featureClick",t.detail)}function Oe(t){console.log(`Maps:onStop(stopID:${t})`),N(i,t,!0),t?a().views[e(o)].stops&&a().views[e(o)].stops[e(i)]&&H(a().views[e(o)].stops[e(i)].extent):H(a().views[e(o)].extent)}var K=ut(),me=M(K);{var Ee=t=>{var l=rt(),I=M(l),D=M(I,!0);h(I);var s=q(I,2),d=M(s);h(s),h(l),ne(()=>{Me(D,a().eras[e(_)].shortLabel),Me(d,`${a().eras[e(_)].longLabel??""} (New Map!!!)`)}),p(t,l)};w(me,t=>{e(_)&&t(Ee)})}var be=q(me,2);{var je=t=>{var l=vt(),I=M(l),D=M(I),s=M(D,!0);h(D),$e(D,(k,u)=>{var V;return(V=xe)==null?void 0:V(k,u)},()=>Oe);var d=q(D,2);De(d,17,()=>a().views[e(o)].story,Je,(k,u)=>{var V=P(),Q=T(V);{var ie=j=>{var W=P(),J=T(W);{var $=f=>{var v=it(),c=M(v);we(c,()=>e(u).text),h(v),$e(v,(m,b)=>{var g;return(g=xe)==null?void 0:g(m,b)},()=>Oe),ne(()=>Be(v,"data-id",e(u).stop)),p(f,v)},E=f=>{var v=nt(),c=M(v);we(c,()=>e(u).text),h(v),p(f,v)};w(J,f=>{e(u).stop?f($):f(E,!1)})}p(j,W)},ge=(j,W)=>{{var J=$=>{var E=lt(),f=M(E);we(f,()=>e(u).text),h(E),p($,E)};w(j,$=>{e(u).type=="p"&&$(J)},W)}};w(Q,j=>{e(u).type=="h"?j(ie):j(ge,!1)})}p(k,V)}),h(I),h(l),ne(()=>Me(s,a().views[e(o)].name)),p(t,l)};w(be,t=>{a().views[e(o)].story&&t(je)})}var re=q(be,2);let Ne;var pe=M(re),Te=M(pe);{var Ve=t=>{var l=P(),I=T(l);De(I,17,()=>Object.values(a().maps),Je,(D,s,d)=>{var k=P(),u=T(k);{var V=Q=>{var ie=P(),ge=T(ie);{var j=J=>{var $=P(),E=T($);{var f=c=>{const m=R(()=>e(s).geometryType?e(s).geometryType:"polygons"),b=R(()=>e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id));S(Se(c,{get activeViewID(){return e(o)},get activeEraID(){return e(_)},get activeStopID(){return e(i)},get url(){return e(s).url},get topoJson(){return e(s).topoJson},get topoJsonObjectsName(){return e(s).topoJsonObjectsName},get geometryType(){return e(m)},get id(){return e(s).id},get projection(){return e(O)},get visible(){return e(b)},interactive:!0,$$events:{featureMouseOver:oe,featureMouseOut:ye,featureClick:_e}}),(g,X)=>n[X]=g,g=>n==null?void 0:n[g],()=>[d])},v=c=>{const m=R(()=>e(s).geometryType?e(s).geometryType:"polygons"),b=R(()=>e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id));S(Se(c,{get activeViewID(){return e(o)},get activeEraID(){return e(_)},get activeStopID(){return e(i)},get url(){return e(s).url},get topoJson(){return e(s).topoJson},get topoJsonObjectsName(){return e(s).topoJsonObjectsName},get geometryType(){return e(m)},get id(){return e(s).id},get projection(){return e(O)},get visible(){return e(b)}}),(g,X)=>n[X]=g,g=>n==null?void 0:n[g],()=>[d])};w(E,c=>{e(s).interactive?c(f):c(v,!1)})}p(J,$)},W=(J,$)=>{{var E=v=>{const c=R(()=>e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id));S(ot(v,{get urlPath(){return e(s).urlPath},get urlExtension(){return e(s).urlExtension},get projection(){return e(O)},get visible(){return e(c)}}),(m,b)=>n[b]=m,m=>n==null?void 0:n[m],()=>[d])},f=(v,c)=>{{var m=b=>{var g=P(),X=T(g);{var ze=Z=>{const de=R(()=>e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id));S(Le(Z,{get activeViewID(){return e(o)},get activeEraID(){return e(_)},get activeStopID(){return e(i)},get path(){return e(s).path},get id(){return e(s).id},get projection(){return e(O)},get visible(){return e(de)},get labelField(){return e(s).labelField},get filterOnContext(){return e(s).filterOnContext},get interactive(){return e(s).interactive},$$events:{featureMouseOver:oe,featureMouseOut:ye,featureClick:_e}}),(z,fe)=>n[fe]=z,z=>n==null?void 0:n[z],()=>[d])},Pe=Z=>{const de=R(()=>e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id));S(Le(Z,{get activeViewID(){return e(o)},get activeEraID(){return e(_)},get activeStopID(){return e(i)},get path(){return e(s).path},get id(){return e(s).id},get projection(){return e(O)},get visible(){return e(de)},get labelField(){return e(s).labelField},get filterOnContext(){return e(s).filterOnContext},get interactive(){return e(s).interactive}}),(z,fe)=>n[fe]=z,z=>n==null?void 0:n[z],()=>[d])};w(X,Z=>{e(s).interactive?Z(ze):Z(Pe,!1)})}p(b,g)};w(v,b=>{e(s).type=="label"&&b(m)},c)}};w(J,v=>{e(s).type=="tile"?v(E):v(f,!1)},$)}};w(ge,J=>{e(s).type=="shapefile"?J(j):J(W,!1)})}p(Q,ie)};w(u,Q=>{(e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id))&&Q(V)})}p(D,k)}),p(t,l)};w(Te,t=>{e(se)||t(Ve)})}return h(pe),S(pe,t=>N(L,t),()=>e(L)),h(re),S(re,t=>N(C,t),()=>e(C)),h(K),ne(t=>{Ie(K,1,`${`view-${e(o)}`} ${`era-${e(_)}`} ${`stop-${e(i)}`}`,"svelte-7d3ou1"),Ze(K,`--color-era-urban-industrial: ${he.colorEraUrbanIndustrial}; --color-era-pre-1600s: ${he.colorEraPre1600s}; --color-era-early-european-settlement: ${he.colorEraEarlyEuropeanSettlement}`),Ne=Ie(re,0,"svelte-7d3ou1",null,Ne,t)},[()=>({story:a().views[e(o)].story!=null})]),p(le,K),ke({onChapterMouseOver:ve,onChapterMouseLeave:ue,onNavigate:B})}var pt=G("<!> <!> <!>",1);function mt(le,ee){Fe(ee,!0);const[a,ve]=Ue(),ue=()=>He(Xe,"$page",a);let B=x(void 0),n=x(void 0),C=x(void 0),L="intro";Y.views[L];let y=null;function F(r){console.log("routes/map:onFeatureMouseOver(event.detail:"+JSON.stringify(r.detail)+")"),e(n).onMapFeatureMouseOver(r)}function te(r){console.log("routes/map:onMapFeatureMouseOut(event.detail:"+JSON.stringify(r.detail)+")"),e(n).onMapFeatureMouseOut(r)}function o(r){console.log("routes/map:onChapterMouseOver(event.detail:"+JSON.stringify(r.detail)+")"),e(C).onChapterMouseOver(r)}function _(r){console.log("routes/map:onChapterMouseLeave(event.detail:"+JSON.stringify(r.detail)+")"),e(C).onChapterMouseLeave(r)}function i(r){console.log("routes/map:onFeatureClick(event.detail:"+JSON.stringify(r.detail)+")"),e(n).onMapFeatureClick(r)}function O(r,oe=!0){console.log(`routes/map:onNavigate(event.detail:${JSON.stringify(r.detail)})`),L=r.detail.viewID,Y.views[L],y=r.detail.eraID,y&&Y.eras[y],e(B).navigate(r),e(C).onNavigate(r),e(n).onNavigate(r),oe&&We(`#/view/${r.detail.viewID}`,{state:r.detail})}function se(r){r.state&&(console.log(`routes/:popstate:event.state:${JSON.stringify(r.state)}`),console.log(`routes/:popstate:page.state:${JSON.stringify(ue().state)}`),r.state["sveltekit:states"].viewID&&O({detail:{...r.state["sveltekit:states"]}},!1))}var ae=pt();Ae("popstate",Re,se);var U=T(ae);S(Ke(U,{$$events:{navigate:O}}),r=>N(B,r,!0),()=>e(B));var H=q(U,2);S(ct(H,{story:Y,$$events:{featureMouseOver:F,featureMouseOut:te,featureClick:i}}),r=>N(C,r,!0),()=>e(C));var ce=q(H,2);S(Qe(ce,{get eras(){return Y.eras},$$events:{chapterMouseOver:o,chapterMouseLeave:_,navigate:O}}),r=>N(n,r,!0),()=>e(n)),p(le,ae),ke(),ve()}export{mt as component};
