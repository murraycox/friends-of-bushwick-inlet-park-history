import{f as G,a as p,c as P}from"../chunks/DMFbEwmD.js";import{p as Fe,j as Ce,k as S,l as e,g as h,m as N,s as q,t as ne,e as je,r as M,f as T,u as R,$ as Re}from"../chunks/DOY4fili.js";import{s as he,e as Ae}from"../chunks/D-NiPBEI.js";import{p as Ge,i as w,b as $,s as Ue,a as He}from"../chunks/BSIkstgr.js";import{g as We}from"../chunks/Cn-m27GJ.js";import{e as A,s as Ie,b as Ze,j as qe,i as Be,c as Me,f as Je,g as xe,h as we,d as Ke,N as Qe,a as Xe,p as Ye}from"../chunks/CI3LmID7.js";import{o as et,c as tt}from"../chunks/CVwtih0k.js";import{z as st,g as at,a as ot,b as De,o as Se,M as $e,T as rt,L as Le}from"../chunks/FMXLWqka.js";import{s as Y}from"../chunks/C03XgqdC.js";var it=G('<div id="story-context-container" class="svelte-7d3ou1"><div id="era-short-label" class="svelte-7d3ou1"> </div> <div id="era-long-label" class="svelte-7d3ou1"> </div></div>'),nt=G('<h2 class="svelte-7d3ou1"><!></h2>'),lt=G('<h2 class="svelte-7d3ou1"><!></h2>'),ut=G("<p><!></p>"),vt=G('<div id="story-narrative-container" class="svelte-7d3ou1"><div id="story-narrative" class="svelte-7d3ou1"><h1 class="svelte-7d3ou1"> </h1> <!></div></div>'),ct=G('<div id="map"><!> <!> <svg id="map-svg"><g><!></g></svg></div>');function pt(le,ee){Fe(ee,!0);let a=Ge(ee,"story",19,()=>({}));function ue(t){console.log("Maps:onChapterMouseOver(event:"+JSON.stringify(t.detail)+")"),n.forEach(l=>{l.onChapterMouseOver&&l.onChapterMouseOver(t)})}function ve(t){console.log("Maps:onChapterMouseLeave(event:"+JSON.stringify(t.detail)+")"),n.forEach(l=>{l.onChapterMouseLeave&&l.onChapterMouseLeave(t)})}function B(t){console.log(`Maps:onNavigate(event:${JSON.stringify(t.detail)})`),N(o,t.detail.viewID,!0),N(O,t.detail.eraID,!0),N(i,null),a().views[e(o)].extent&&H(a().views[e(o)].extent)}let n=Ce([]),C=S(void 0),L=S(void 0),y,F,te,o=S(Ce(a().intialView)),O=S(null),i=S(null),_=S(void 0),se=S(!0);const ae=4500;et(()=>{console.log("Maps:onMount()"),y=parseInt(A(e(C)).style("width"),10),F=parseInt(A(e(C)).style("height"),10),console.log(`Map width: ${y}; height: ${F}`),N(_,ot().rotate([74,0]).fitSize([y,F],r(a().views[a().intialView].extent)),!0),N(se,!1)}),te=st().on("zoom",ce);const U=tt();function H(t){console.log(`Maps:moveMap(extent:${JSON.stringify(t)}`),y=parseInt(A("#map-svg").style("width"),10),F=parseInt(A("#map-svg").style("height"),10),console.log(`Map width: ${y}; height: ${F}`);const l=r(t);var I=at().projection(e(_));const J=I.bounds(l),[[s,d],[j,v]]=J;A(e(L)).transition().duration(ae).ease(qe).call(te.transform,Be.translate(y/2,F/2).scale(.9/Math.max((j-s)/y,(v-d)/F)).translate(-(s+j)/2,-(d+v)/2))}function ce(t){const{transform:l}=t;A(e(L)).attr("transform",l),A(e(L)).selectAll("text").attr("font-size",10/l.k)}function r(t){return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{coordinates:[[[t.nwLng,t.nwLat],[t.seLng,t.nwLat],[t.seLng,t.seLat],[t.nwLng,t.seLat],[t.nwLng,t.nwLat]]],type:"Polygon"}}]}}function oe(t){console.log("Maps:onFeatureMouseOver(event.detail:"+JSON.stringify(t.detail)+")"),U("featureMouseOver",t.detail)}function ye(t){console.log("Maps:onFeatureMouseOut(event.detail:"+JSON.stringify(t.detail)+")"),U("featureMouseOut",t.detail)}function Oe(t){console.log("Maps:onFeatureClick(event.detail:"+JSON.stringify(t.detail)+")"),U("featureClick",t.detail)}function _e(t){console.log(`Maps:onStop(stopID:${t})`),N(i,t,!0),t?a().views[e(o)].stops&&a().views[e(o)].stops[e(i)]&&H(a().views[e(o)].stops[e(i)].extent):H(a().views[e(o)].extent)}var K=ct(),me=h(K);{var ke=t=>{var l=it(),I=h(l),J=h(I,!0);M(I);var s=q(I,2),d=h(s,!0);M(s),M(l),ne(()=>{he(J,a().eras[e(O)].shortLabel),he(d,a().eras[e(O)].longLabel)}),p(t,l)};w(me,t=>{e(O)&&t(ke)})}var be=q(me,2);{var Ee=t=>{var l=vt(),I=h(l),J=h(I),s=h(J,!0);M(J),De(J,(j,v)=>{var V;return(V=Se)==null?void 0:V(j,v)},()=>_e);var d=q(J,2);Je(d,17,()=>a().views[e(o)].story,xe,(j,v)=>{var V=P(),Q=T(V);{var ie=E=>{var W=P(),x=T(W);{var D=f=>{var u=nt(),c=h(u);we(c,()=>e(v).text),M(u),De(u,(m,b)=>{var g;return(g=Se)==null?void 0:g(m,b)},()=>_e),ne(()=>Ke(u,"data-id",e(v).stop)),p(f,u)},k=f=>{var u=lt(),c=h(u);we(c,()=>e(v).text),M(u),p(f,u)};w(x,f=>{e(v).stop?f(D):f(k,!1)})}p(E,W)},ge=(E,W)=>{{var x=D=>{var k=ut(),f=h(k);we(f,()=>e(v).text),M(k),p(D,k)};w(E,D=>{e(v).type=="p"&&D(x)},W)}};w(Q,E=>{e(v).type=="h"?E(ie):E(ge,!1)})}p(j,V)}),M(I),M(l),ne(()=>he(s,a().views[e(o)].name)),p(t,l)};w(be,t=>{a().views[e(o)].story&&t(Ee)})}var re=q(be,2);let Ne;var pe=h(re),Te=h(pe);{var Ve=t=>{var l=P(),I=T(l);Je(I,17,()=>Object.values(a().maps),xe,(J,s,d)=>{var j=P(),v=T(j);{var V=Q=>{var ie=P(),ge=T(ie);{var E=x=>{var D=P(),k=T(D);{var f=c=>{const m=R(()=>e(s).geometryType?e(s).geometryType:"polygons"),b=R(()=>e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id));$($e(c,{get activeViewID(){return e(o)},get activeEraID(){return e(O)},get activeStopID(){return e(i)},get url(){return e(s).url},get topoJson(){return e(s).topoJson},get topoJsonObjectsName(){return e(s).topoJsonObjectsName},get geometryType(){return e(m)},get id(){return e(s).id},get projection(){return e(_)},get visible(){return e(b)},interactive:!0,$$events:{featureMouseOver:oe,featureMouseOut:ye,featureClick:Oe}}),(g,X)=>n[X]=g,g=>n==null?void 0:n[g],()=>[d])},u=c=>{const m=R(()=>e(s).geometryType?e(s).geometryType:"polygons"),b=R(()=>e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id));$($e(c,{get activeViewID(){return e(o)},get activeEraID(){return e(O)},get activeStopID(){return e(i)},get url(){return e(s).url},get topoJson(){return e(s).topoJson},get topoJsonObjectsName(){return e(s).topoJsonObjectsName},get geometryType(){return e(m)},get id(){return e(s).id},get projection(){return e(_)},get visible(){return e(b)}}),(g,X)=>n[X]=g,g=>n==null?void 0:n[g],()=>[d])};w(k,c=>{e(s).interactive?c(f):c(u,!1)})}p(x,D)},W=(x,D)=>{{var k=u=>{const c=R(()=>e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id));$(rt(u,{get urlPath(){return e(s).urlPath},get urlExtension(){return e(s).urlExtension},get projection(){return e(_)},get visible(){return e(c)}}),(m,b)=>n[b]=m,m=>n==null?void 0:n[m],()=>[d])},f=(u,c)=>{{var m=b=>{var g=P(),X=T(g);{var ze=Z=>{const de=R(()=>e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id));$(Le(Z,{get activeViewID(){return e(o)},get activeEraID(){return e(O)},get activeStopID(){return e(i)},get path(){return e(s).path},get id(){return e(s).id},get projection(){return e(_)},get visible(){return e(de)},get labelField(){return e(s).labelField},get filterOnContext(){return e(s).filterOnContext},get interactive(){return e(s).interactive},$$events:{featureMouseOver:oe,featureMouseOut:ye,featureClick:Oe}}),(z,fe)=>n[fe]=z,z=>n==null?void 0:n[z],()=>[d])},Pe=Z=>{const de=R(()=>e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id));$(Le(Z,{get activeViewID(){return e(o)},get activeEraID(){return e(O)},get activeStopID(){return e(i)},get path(){return e(s).path},get id(){return e(s).id},get projection(){return e(_)},get visible(){return e(de)},get labelField(){return e(s).labelField},get filterOnContext(){return e(s).filterOnContext},get interactive(){return e(s).interactive}}),(z,fe)=>n[fe]=z,z=>n==null?void 0:n[z],()=>[d])};w(X,Z=>{e(s).interactive?Z(ze):Z(Pe,!1)})}p(b,g)};w(u,b=>{e(s).type=="label"&&b(m)},c)}};w(x,u=>{e(s).type=="tile"?u(k):u(f,!1)},D)}};w(ge,x=>{e(s).type=="shapefile"?x(E):x(W,!1)})}p(Q,ie)};w(v,Q=>{(e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id))&&Q(V)})}p(J,j)}),p(t,l)};w(Te,t=>{e(se)||t(Ve)})}return M(pe),$(pe,t=>N(L,t),()=>e(L)),M(re),$(re,t=>N(C,t),()=>e(C)),M(K),ne(t=>{Ie(K,1,`${`view-${e(o)}`} ${`era-${e(O)}`} ${`stop-${e(i)}`}`,"svelte-7d3ou1"),Ze(K,`--color-era-urban-industrial: ${Me.colorEraUrbanIndustrial}; --color-era-pre-1600s: ${Me.colorEraPre1600s}; --color-era-early-european-settlement: ${Me.colorEraEarlyEuropeanSettlement}`),Ne=Ie(re,0,"svelte-7d3ou1",null,Ne,t)},[()=>({story:a().views[e(o)].story!=null})]),p(le,K),je({onChapterMouseOver:ue,onChapterMouseLeave:ve,onNavigate:B})}var gt=G("<!> <!> <!>",1);function bt(le,ee){Fe(ee,!0);const[a,ue]=Ue(),ve=()=>He(Ye,"$page",a);let B=S(void 0),n=S(void 0),C=S(void 0),L="intro";Y.views[L];let y=null;function F(r){console.log("routes/map:onFeatureMouseOver(event.detail:"+JSON.stringify(r.detail)+")"),e(n).onMapFeatureMouseOver(r)}function te(r){console.log("routes/map:onMapFeatureMouseOut(event.detail:"+JSON.stringify(r.detail)+")"),e(n).onMapFeatureMouseOut(r)}function o(r){console.log("routes/map:onChapterMouseOver(event.detail:"+JSON.stringify(r.detail)+")"),e(C).onChapterMouseOver(r)}function O(r){console.log("routes/map:onChapterMouseLeave(event.detail:"+JSON.stringify(r.detail)+")"),e(C).onChapterMouseLeave(r)}function i(r){console.log("routes/map:onFeatureClick(event.detail:"+JSON.stringify(r.detail)+")"),e(n).onMapFeatureClick(r)}function _(r,oe=!0){console.log(`routes/map:onNavigate(event.detail:${JSON.stringify(r.detail)})`),L=r.detail.viewID,Y.views[L],y=r.detail.eraID,y&&Y.eras[y],e(B).navigate(r),e(C).onNavigate(r),e(n).onNavigate(r),oe&&We(`#/view/${r.detail.viewID}`,{state:r.detail})}function se(r){r.state&&(console.log(`routes/:popstate:event.state:${JSON.stringify(r.state)}`),console.log(`routes/:popstate:page.state:${JSON.stringify(ve().state)}`),r.state["sveltekit:states"].viewID&&_({detail:{...r.state["sveltekit:states"]}},!1))}var ae=gt();Ae("popstate",Re,se);var U=T(ae);$(Qe(U,{$$events:{navigate:_}}),r=>N(B,r,!0),()=>e(B));var H=q(U,2);$(pt(H,{story:Y,$$events:{featureMouseOver:F,featureMouseOut:te,featureClick:i}}),r=>N(C,r,!0),()=>e(C));var ce=q(H,2);$(Xe(ce,{get eras(){return Y.eras},$$events:{chapterMouseOver:o,chapterMouseLeave:O,navigate:_}}),r=>N(n,r,!0),()=>e(n)),p(le,ae),je(),ue()}export{bt as component};
