import{f as G,a as p,c as P}from"../chunks/DGGwx3xc.js";import{p as Fe,o as Ce,q as S,v as e,g as h,w as N,s as Z,t as ne,e as Ee,r as w,f as T,x as R,$ as Re}from"../chunks/D6p2bPIS.js";import{s as he,e as Ae}from"../chunks/CdfSubKN.js";import{p as Ge,i as M,b as $,a as Ue,s as qe}from"../chunks/DG-iDFzR.js";import{g as He}from"../chunks/DLxROzDA.js";import{d as A,s as Ie,b as We,j as Ze,i as Be,c as we,e as xe,f as Je,h as Me,g as Ke,N as Qe,a as Xe,p as Ye}from"../chunks/C9nAIKQX.js";import{o as et,c as tt}from"../chunks/DEdxNy7H.js";import{a as De,o as Se}from"../chunks/YEikM6LL.js";import{z as st,g as at,a as ot,M as $e,T as rt,L as Le}from"../chunks/gyC42Tpp.js";import{s as Y}from"../chunks/BK0IujWt.js";var it=G('<div id="story-context-container" class="svelte-7d3ou1"><div id="era-short-label" class="svelte-7d3ou1"> </div> <div id="era-long-label" class="svelte-7d3ou1"> </div></div>'),nt=G('<h2 class="svelte-7d3ou1"><!></h2>'),lt=G('<h2 class="svelte-7d3ou1"><!></h2>'),vt=G("<p><!></p>"),ut=G('<div id="story-narrative-container" class="svelte-7d3ou1"><div id="story-narrative" class="svelte-7d3ou1"><h1 class="svelte-7d3ou1"> </h1> <!></div></div>'),ct=G('<div id="map"><!> <!> <svg id="map-svg"><g><!></g></svg></div>');function pt(le,ee){Fe(ee,!0);let a=Ge(ee,"story",19,()=>({}));function ve(t){console.log("Maps:onChapterMouseOver(event:"+JSON.stringify(t.detail)+")"),n.forEach(l=>{l.onChapterMouseOver&&l.onChapterMouseOver(t)})}function ue(t){console.log("Maps:onChapterMouseLeave(event:"+JSON.stringify(t.detail)+")"),n.forEach(l=>{l.onChapterMouseLeave&&l.onChapterMouseLeave(t)})}function B(t){console.log(`Maps:onNavigate(event:${JSON.stringify(t.detail)})`),N(o,t.detail.viewID,!0),N(O,t.detail.eraID,!0),N(i,null),a().views[e(o)].extent&&q(a().views[e(o)].extent)}let n=Ce([]),C=S(void 0),L=S(void 0),y,F,te,o=S(Ce(a().intialView)),O=S(null),i=S(null),_=S(void 0),se=S(!0);const ae=4500;et(()=>{console.log("Maps:onMount()"),y=parseInt(A(e(C)).style("width"),10),F=parseInt(A(e(C)).style("height"),10),console.log(`Map width: ${y}; height: ${F}`),N(_,ot().rotate([74,0]).fitSize([y,F],r(a().views[a().intialView].extent)),!0),N(se,!1)}),te=st().on("zoom",ce);const U=tt();function q(t){console.log(`Maps:moveMap(extent:${JSON.stringify(t)}`),y=parseInt(A("#map-svg").style("width"),10),F=parseInt(A("#map-svg").style("height"),10),console.log(`Map width: ${y}; height: ${F}`);const l=r(t);var I=at().projection(e(_));const x=I.bounds(l),[[s,d],[E,u]]=x;A(e(L)).transition().duration(ae).ease(Ze).call(te.transform,Be.translate(y/2,F/2).scale(.9/Math.max((E-s)/y,(u-d)/F)).translate(-(s+E)/2,-(d+u)/2))}function ce(t){const{transform:l}=t;A(e(L)).attr("transform",l),A(e(L)).selectAll("text").attr("font-size",10/l.k)}function r(t){return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{coordinates:[[[t.nwLng,t.nwLat],[t.seLng,t.nwLat],[t.seLng,t.seLat],[t.nwLng,t.seLat],[t.nwLng,t.nwLat]]],type:"Polygon"}}]}}function oe(t){console.log("Maps:onFeatureMouseOver(event.detail:"+JSON.stringify(t.detail)+")"),U("featureMouseOver",t.detail)}function ye(t){console.log("Maps:onFeatureMouseOut(event.detail:"+JSON.stringify(t.detail)+")"),U("featureMouseOut",t.detail)}function Oe(t){console.log("Maps:onFeatureClick(event.detail:"+JSON.stringify(t.detail)+")"),U("featureClick",t.detail)}function _e(t){console.log(`Maps:onStop(stopID:${t})`),N(i,t,!0),t?a().views[e(o)].stops&&a().views[e(o)].stops[e(i)]&&q(a().views[e(o)].stops[e(i)].extent):q(a().views[e(o)].extent)}var K=ct(),me=h(K);{var je=t=>{var l=it(),I=h(l),x=h(I,!0);w(I);var s=Z(I,2),d=h(s,!0);w(s),w(l),ne(()=>{he(x,a().eras[e(O)].shortLabel),he(d,a().eras[e(O)].longLabel)}),p(t,l)};M(me,t=>{e(O)&&t(je)})}var be=Z(me,2);{var ke=t=>{var l=ut(),I=h(l),x=h(I),s=h(x,!0);w(x),De(x,(E,u)=>{var V;return(V=Se)==null?void 0:V(E,u)},()=>_e);var d=Z(x,2);xe(d,17,()=>a().views[e(o)].story,Je,(E,u)=>{var V=P(),Q=T(V);{var ie=k=>{var H=P(),J=T(H);{var D=f=>{var v=nt(),c=h(v);Me(c,()=>e(u).text),w(v),De(v,(m,b)=>{var g;return(g=Se)==null?void 0:g(m,b)},()=>_e),ne(()=>Ke(v,"data-id",e(u).stop)),p(f,v)},j=f=>{var v=lt(),c=h(v);Me(c,()=>e(u).text),w(v),p(f,v)};M(J,f=>{e(u).stop?f(D):f(j,!1)})}p(k,H)},ge=(k,H)=>{{var J=D=>{var j=vt(),f=h(j);Me(f,()=>e(u).text),w(j),p(D,j)};M(k,D=>{e(u).type=="p"&&D(J)},H)}};M(Q,k=>{e(u).type=="h"?k(ie):k(ge,!1)})}p(E,V)}),w(I),w(l),ne(()=>he(s,a().views[e(o)].name)),p(t,l)};M(be,t=>{a().views[e(o)].story&&t(ke)})}var re=Z(be,2);let Ne;var pe=h(re),Te=h(pe);{var Ve=t=>{var l=P(),I=T(l);xe(I,17,()=>Object.values(a().maps),Je,(x,s,d)=>{var E=P(),u=T(E);{var V=Q=>{var ie=P(),ge=T(ie);{var k=J=>{var D=P(),j=T(D);{var f=c=>{const m=R(()=>e(s).geometryType?e(s).geometryType:"polygons"),b=R(()=>e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id));$($e(c,{get activeViewID(){return e(o)},get activeEraID(){return e(O)},get activeStopID(){return e(i)},get url(){return e(s).url},get topoJson(){return e(s).topoJson},get topoJsonObjectsName(){return e(s).topoJsonObjectsName},get geometryType(){return e(m)},get id(){return e(s).id},get projection(){return e(_)},get visible(){return e(b)},interactive:!0,$$events:{featureMouseOver:oe,featureMouseOut:ye,featureClick:Oe}}),(g,X)=>n[X]=g,g=>n==null?void 0:n[g],()=>[d])},v=c=>{const m=R(()=>e(s).geometryType?e(s).geometryType:"polygons"),b=R(()=>e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id));$($e(c,{get activeViewID(){return e(o)},get activeEraID(){return e(O)},get activeStopID(){return e(i)},get url(){return e(s).url},get topoJson(){return e(s).topoJson},get topoJsonObjectsName(){return e(s).topoJsonObjectsName},get geometryType(){return e(m)},get id(){return e(s).id},get projection(){return e(_)},get visible(){return e(b)}}),(g,X)=>n[X]=g,g=>n==null?void 0:n[g],()=>[d])};M(j,c=>{e(s).interactive?c(f):c(v,!1)})}p(J,D)},H=(J,D)=>{{var j=v=>{const c=R(()=>e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id));$(rt(v,{get urlPath(){return e(s).urlPath},get urlExtension(){return e(s).urlExtension},get projection(){return e(_)},get visible(){return e(c)}}),(m,b)=>n[b]=m,m=>n==null?void 0:n[m],()=>[d])},f=(v,c)=>{{var m=b=>{var g=P(),X=T(g);{var ze=W=>{const de=R(()=>e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id));$(Le(W,{get activeViewID(){return e(o)},get activeEraID(){return e(O)},get activeStopID(){return e(i)},get path(){return e(s).path},get id(){return e(s).id},get projection(){return e(_)},get visible(){return e(de)},get labelField(){return e(s).labelField},get filterOnContext(){return e(s).filterOnContext},get interactive(){return e(s).interactive},$$events:{featureMouseOver:oe,featureMouseOut:ye,featureClick:Oe}}),(z,fe)=>n[fe]=z,z=>n==null?void 0:n[z],()=>[d])},Pe=W=>{const de=R(()=>e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id));$(Le(W,{get activeViewID(){return e(o)},get activeEraID(){return e(O)},get activeStopID(){return e(i)},get path(){return e(s).path},get id(){return e(s).id},get projection(){return e(_)},get visible(){return e(de)},get labelField(){return e(s).labelField},get filterOnContext(){return e(s).filterOnContext},get interactive(){return e(s).interactive}}),(z,fe)=>n[fe]=z,z=>n==null?void 0:n[z],()=>[d])};M(X,W=>{e(s).interactive?W(ze):W(Pe,!1)})}p(b,g)};M(v,b=>{e(s).type=="label"&&b(m)},c)}};M(J,v=>{e(s).type=="tile"?v(j):v(f,!1)},D)}};M(ge,J=>{e(s).type=="shapefile"?J(k):J(H,!1)})}p(Q,ie)};M(u,Q=>{(e(i)==null&&a().views[e(o)].maps&&a().views[e(o)].maps.includes(e(s).id)||e(i)&&a().views[e(o)].stops[e(i)].maps&&a().views[e(o)].stops[e(i)].maps.includes(e(s).id))&&Q(V)})}p(x,E)}),p(t,l)};M(Te,t=>{e(se)||t(Ve)})}return w(pe),$(pe,t=>N(L,t),()=>e(L)),w(re),$(re,t=>N(C,t),()=>e(C)),w(K),ne(t=>{Ie(K,1,`${`view-${e(o)}`} ${`era-${e(O)}`} ${`stop-${e(i)}`}`,"svelte-7d3ou1"),We(K,`--color-era-urban-industrial: ${we.colorEraUrbanIndustrial}; --color-era-pre-1600s: ${we.colorEraPre1600s}; --color-era-early-european-settlement: ${we.colorEraEarlyEuropeanSettlement}`),Ne=Ie(re,0,"svelte-7d3ou1",null,Ne,t)},[()=>({story:a().views[e(o)].story!=null})]),p(le,K),Ee({onChapterMouseOver:ve,onChapterMouseLeave:ue,onNavigate:B})}var gt=G("<!> <!> <!>",1);function Nt(le,ee){Fe(ee,!0);const[a,ve]=Ue(),ue=()=>qe(Ye,"$page",a);let B=S(void 0),n=S(void 0),C=S(void 0),L="intro";Y.views[L];let y=null;function F(r){console.log("routes/map:onFeatureMouseOver(event.detail:"+JSON.stringify(r.detail)+")"),e(n).onMapFeatureMouseOver(r)}function te(r){console.log("routes/map:onMapFeatureMouseOut(event.detail:"+JSON.stringify(r.detail)+")"),e(n).onMapFeatureMouseOut(r)}function o(r){console.log("routes/map:onChapterMouseOver(event.detail:"+JSON.stringify(r.detail)+")"),e(C).onChapterMouseOver(r)}function O(r){console.log("routes/map:onChapterMouseLeave(event.detail:"+JSON.stringify(r.detail)+")"),e(C).onChapterMouseLeave(r)}function i(r){console.log("routes/map:onFeatureClick(event.detail:"+JSON.stringify(r.detail)+")"),e(n).onMapFeatureClick(r)}function _(r,oe=!0){console.log(`routes/map:onNavigate(event.detail:${JSON.stringify(r.detail)})`),L=r.detail.viewID,Y.views[L],y=r.detail.eraID,y&&Y.eras[y],e(B).navigate(r),e(C).onNavigate(r),e(n).onNavigate(r),oe&&He(`#/view/${r.detail.viewID}`,{state:r.detail})}function se(r){r.state&&(console.log(`routes/:popstate:event.state:${JSON.stringify(r.state)}`),console.log(`routes/:popstate:page.state:${JSON.stringify(ue().state)}`),r.state["sveltekit:states"].viewID&&_({detail:{...r.state["sveltekit:states"]}},!1))}var ae=gt();Ae("popstate",Re,se);var U=T(ae);$(Qe(U,{$$events:{navigate:_}}),r=>N(B,r,!0),()=>e(B));var q=Z(U,2);$(pt(q,{story:Y,$$events:{featureMouseOver:F,featureMouseOut:te,featureClick:i}}),r=>N(C,r,!0),()=>e(C));var ce=Z(q,2);$(Xe(ce,{get eras(){return Y.eras},$$events:{chapterMouseOver:o,chapterMouseLeave:O,navigate:_}}),r=>N(n,r,!0),()=>e(n)),p(le,ae),Ee(),ve()}export{Nt as component};
